sudo: required
language: node_js
env:
  global:
  - VERSION=$TRAVIS_TAG
  - VERSION_COMMIT=$TRAVIS_COMMIT
services:
- docker
node_js:
- 10.13
cache:
  directories:
  - node_modules
notifications:
  email: false
  slack:
    rooms:
      secure: WrZzlHvjggJX8T1I9/6r4O8NpGoz7jkXD7aa9k1ZzQpStQ6M+1libHZOgAQxi3jSn0BdDEuC6CbDOx+JgljZ+gd/1vxXPc0BUDVCUqvXGVRDAYHxJHaeAav27RMc3FsxdQp0vQyu77x6/hQYnu6XpwagKmw51fc2RrHxUvgoqYKA7HaCyeHNXfk3ApeoTnPaAmQeD56Ssxcms3HfyEKRbCLXSJX81pH3kKZUWbzA4RACAuInDxzK8eT+6EDNFV8UvCipnz1y0pPBHY1u8+IyCO2eKMGqoeOWCUXsUd9nvsZscU035lfVexZeaQGQsoB7JdoBM1n3grT/D3UEC89kYP/DwQQMQ+ogfItB96TSqHpl2rcNN8qZvh9MfSDy/eZqyG/QiNt9PkmgYv9eRUrJVBKwu2tZzfYCOwpJMUKeFPtivH1yVnyffQQSEl5+2yvR6TS8sKodQ7oizEFLX7BpOdLVfriMx6pc8tNHeaU2QPSaQK3xd3SvNzksos5ynylQpyULi2LVUqyxDnM4JhroyKGHZCC1uSxxXcBicU+9bjLCJ8DtYWor8YIB90fV7XW0O3rd3Rh39mcQh5s2EaTpBvjsfCFqZp5h12Miuj+lmz+Ql5jAxjZwqJSiLJ3jArz/7tuuCflWo//VuBXqGGk1BWDoOHEuvAqe9NR5o/x09q8=
    on_success: never
    on_pull_requests: false
before_install:
- npm install -g greenkeeper-lockfile@1
install:
- npm install
before_script:
- npm prune
- greenkeeper-lockfile-update
script:
- |
  npm test && \
  docker run --rm --privileged multiarch/qemu-user-static:register --reset && \
  npm run build && \
  npm run docker:test
after_success:
- npm run coveralls
- npm run semantic-release
- |
  ([ "$TRAVIS_BRANCH" == "master" ] && [ "$TRAVIS_PULL_REQUEST" == "false" ] || [ -n "$TRAVIS_TAG" ]) && \
  echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin && \
  npm run push
after_script:
- greenkeeper-lockfile-upload
